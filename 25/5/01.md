# 25/05/01 TIL CS 스터디 & 프로젝트 개발
## TCP/IP 4계층 모델

- 인터넷 프로토콜 스위트(Internet protocol suite)는 인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 프로토콜의 집합
- 이를 TCP/IP 4계층 모델로 설명하거나 OSI 7계층 모델로 설명하기도 함

### 계층 구조

- TCP/IP 계층은 네 개의 계층을 가지고 있으며 OSI 7계층과 많이 비교함
    
    ![image.png](attachment:e642b9a3-59dd-4b45-bdb3-34c86326f92a:image.png)
    
- 그림처럼 TCP/IP 계층과 달리 OSI 계층은 애플리케이션 계층을 세 개로 쪼개고 링크 계층을 데이터 링크 계층, 물리 계층으로 나눠서 표현, 인터넷 계층을 네트워크 계층으로 부른다는 차이
- 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계됨
- 예를 들어 전송 계층에서 TCP를 UDP로 변경했다고 해서 인터넷 웹 브라우저를 다시 설치해야 하는 것은 아니듯 유연하게 설계

![image.png](attachment:657c7bc5-0ba0-4b08-812e-4ee17226c22a:image.png)

#### 애플리케이션(application) 계층

- FTP(File Transfer Protocol)
    - 장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜
- HTTP(Hypertext Transfer Protocol)
    - World Wide Web을 위한 데이터 통신의 기초이자 웹 사이트를 이용하는 데 쓰는 프로토콜
- SSH(Secure Shell)
    - 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
- SMTP(Simple Mail Transfer Protocol)
    - 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
- DNS(Domain Name System)
    - 도메인 이름과 IP 주소를 매핑해주는 서버, 예를 들어 www.naver.com에 DNS 쿼리가 오면 [Root DNS] → [.com DNS] → [.naver DNS] → [.www DNS] 과정을 거쳐 완벽한 주소를 찾아 IP 주소를 매핑.
    - 이를 통해 IP 주소가 바뀌어도 사용자들에게 똑같은 도메인 주소로 서비스할 수 있다.
    - 예를 들어 www.naver.com의 IP 주소가 222.111.222.111에서 222.111.222.122로 바뀌었음에도 똑같은 www.naver.com이라는 주소로 서비스가 가능하다.

#### 전송(transport) 계층

- 송신자와 수신자를 연결하는 통신 서비스를 제공
- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공할 수 있음
- 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중재 역할을 함
- 대표적으로 TCP, UDP가 있음

1. TCP
    - 패킷 사이의 순서를 보장하고 연결지향 프로토콜을 사용해서 연결을 하여 신획성을 구축해서 수신 여부를 확인하며 ‘가상회선 패킷 교환 방식’을 사용
2. UDP
    - 순서를 보장하지 않고 수신 여부를 확인하지 않으며 단수히 데이터만 주는 ‘데이터그램 패킷 교환 방식’을 사용

- **가상회선 패킷 교환 방식**
    - 각 패킷에는 가상회선 식별자가 포함
    - 모든 패킷을 전송하면 가상회선이 해제
    - 패킷들은 전송된 ‘순서대로’ 도착하는 방식
        
        ![image.png](attachment:e20bbf8e-2aca-4e57-8582-eec58c37a3a6:image.png)
        
    - 그림을 보면 3, 2, 1로 이루어진 패킷이 어떠한 회선을 따라 순서대로 도착하는 것을 알 수 있음

- **데이터그램 패킷 교환 방식**
    - 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 감
    - 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있음
    - 도착한 ‘순서가 다를 수’ 있는 방식
        
        ![image.png](attachment:ab0b7015-0db6-47e5-b5a5-6090e9d36b5d:image.png)
        
    - 그림을 보면 3, 2, 1로 이루어진 패킷이 순서도 다르고 어떠한 회선을 중심으로 가는 것이 아닌 따로따로 이동하며 순서도 다르게 도착하는 것을 알 수 있다.

- **TCP 연결 성립 과정**
    - TCP는 신뢰성을 확보할 때 ‘3-웨이 핸드셰이크(3-way handshake)라는 작업을 진행
    
    ![image.png](attachment:ab463884-a7e2-4aba-9d45-e25063e8df2e:image.png)
    
    - 그림처럼 클라이언트와 서버가 통신할 때 다음과 같은 세 단계의 과정을 거침
        1. **SYN 단계:** 
            - 클라이언트는 서버에 클라이언트의 ISN을 담아 SYN을 보냄.
            - ISN은 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호를 말함. 이는 장치마다 다를 수 있음
        2. **SYN + ACK 단계**:
            - 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보냄
            - 승인번호로 클라이언트의 ISN + 1을 보냄
        3. **ACK 단계**:
            - 클라이언트는 서버의 ISN + 1 한 값인 승인번호를 담아 ACK를 서버에 보냄
    - 이러한 3-웨이 핸드셰이크 과정 이후 신뢰성을 구축하고 데이터 전송을 시작
    - TCP는 이 과정이 있기 때문에 신뢰성이 있는 계층이라고 하며, UDP는 이 과정이 없어 신뢰성이 없는 계층이라고 함

**용어 정리**:

- **SYN**:
    - SYNchronization의 약자, 연결 요청 플래그
- **ACK:**
    - ACKnowledgement의 약자, 응답 플래그
- ISN
    - Initial Sequence Numbers의 약어, 초기 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호이다.

**TCP 연결 해제 과정**

- TCP가 연결을 해제할 때는 4-웨이 핸드셰이크(4-way handshake) 과정이 발생

![image.png](attachment:68b9786c-6b28-41eb-bb5e-bada1b301268:image.png)

1. 먼저 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼트를 보냄. 그리고 클라이언트는 FIN_WAIT_1 상태로 들어가고 서버의 응답을 기다림
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보냄. 그리고 CLOSE_WAIT 상태로 들어감. 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어감.
3. 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보냄
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 됨. 이후 클라이언트는 어느 정도의 시간을 대기한 후 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결이 해제됨.
- 이 과정 중 가장 눈여겨봐야 할 것은 TIME_WAIT이다.
- 그냥  연결을 닫지 않고 굳이 일정 시간 뒤에 닫는 이유?
    1. 지연 패킷이 발생할 경우를 대비
        - 패킷이 뒤늦게 도달하고 이를 처리하지 못한다면 데이터 무결성 문제가 발생
        - 예를 들어 전체 데이터가 100일 때 일부 데이터인 50만 들어오는 현상이 발생할 수도 있음
    2. 두 장치가 연결이 닫혔는지 확인하기 위함
        - 만약 LAST_ACK 상태에서 닫히게 되면 다시 새로운 연결을 하려고 할 때 장치는 줄곧 LAST_ACK로 되어 있기 때문에 접속 오류가 나타나게 될 것이다.

**용어 정리**

- **TIME_WAIT**
    - 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태를 말하며 지연 패킷 등의 문제점을 해결하는 데 쓰인다. CentOS6, 우분투에는 60초로 설정되어 있으며 윈도우는 4분으로 설정되어 있다. 즉, OS마다 조금씩 다를 수 있다.
- **데이터 무결성(data integrity)**
    - 데이터의 정확성과 일관성을 유지하고 보증하는 것

#### 인터넷(Internet) 계층

- 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
- IP, ARP, ICMP 등이 있음
- 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달
- 상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징을 가짐

#### 링크(link) 계층

- 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 ‘규칙’을 정하는 계층
- 네트워크 접근 계층이라고도 함
- 물리 계층과 데이터 링크 계층으로 나누기도 함
- 물리계층
    - 무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
- 데이터 계층
    - ‘이더넷 프레임’을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층

#### **유선 LAN(IEEE802.3)**

- 유선 LAN을 이루는 이더넷은 IEEE802.3이라는 프로토콜을 따르며 전이중화 통신을 씀

**전이중화(full duplex) 통신**

- 양쪽 장치가 동시에 송수신할 수 있는 방식.
- 이는 송신로와 수신로로 나눠서 데이터를 주고받으며 현대의 고속 이더넷은 이 방식을 기반으로 통신

![image.png](attachment:528ee64e-b818-4e4d-96a7-9cf2b821d6a2:image.png)

**CSMA/CD**

- 이전에는 유선 LAN에 ‘반이중화 통신’ 중 하나인 CSMA/CD(Carrier Sense Multiple Access with Collision Detection) 방식을 사용.
- 이 방식은 데이터를 ‘보낸 이후’ 충돌이 발생한다면 일정 시간 이후 재전송하는 방식.
- 이는 수신로와 송신로를 각각 둔 것이 아니고 한 경로를 기반으로 데이터를 보내기 때문에 데이터를 보낼 때 충돌에 대해 대비해야 했기 때문.

**유선 LAN을 이루는 케이블**

- 유선 LAN을 이루는 케이블로는 TP 케이블이라고 하는 트위스트 페어 케
이블과 광섬유 케이블이 대표적.

**트위스트 페어 케이블(twisted pair cable)**

- 하나의 케이블처럼 보이지만 실제로는 여덟 개의 구리선을 두 개 씩 꼬아서 묶은 케이블을 지칭.

![image.png](attachment:efc89825-e82c-43f4-bad9-6622ec1e3ee4:image.png)

- 케이블은 구리선을 실드 처리하지 않고 덮은 UTP 케이블과 실드 처리하고 덮은 STP로 나눠짐
- 우리가 많이 볼 수 있는 케이블은 UTP 케이블로 흔히 LAN 케이블이라고 함

![image.png](attachment:eddb18d8-3a81-4335-8e26-b97ad2dd4a97:image.png)

- 이 LAN 케이블을 꽂을 수 있는 커넥터를 RJ-45 커넥터라고 함

**광섬유 케이블**

- 광섬유로 만든 케이블
- 레이저를 이용해서 통신하기 때문에 구리선과는 비교할 수 없을 만큼의 장거리 및 고속 통신이 가능.
- 보통 100Gbps의 데이터를 전송하며 다음 그림처럼 광섬유 내부와 외부를 다른 밀도를 가지는 유리나 플라스틱 섬유로 제작해서 한 번 들어간 빛이 내부에서 계속적으로 반사하며 전진하여 반대편 끝까지 가는 원리를 이용.

![image.png](attachment:e8a1b3bc-f5ca-4a46-8bf1-ceaf6bd25c95:image.png)

- 빛의 굴절률이 높은 부분을 코어(core)라고 하며 낮은 부분을 클래딩(cladding)이라고 함

#### 무선 LAN(IEEE802.11)

- 무선 LAN 장치는 수신과 송신에 같은 채널을 사용하기 때문에 반이중화
통신을 사용.

**반이중화 통신(half duplex)**

- 양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한 번에 한 방향만 통신할 수 있는 방식.

![image.png](attachment:328c90ed-a851-4e48-9f40-64099027b55f:image.png)

- 일반적으로 장치가 신호를 수신하기 시작하면 응답하기 전에 전송이 완료될 때까지 기다려야 함
- 또한, 둘 이상의 장치가 동시에 전송하면 충돌이 발생하여 메시지가 손실되거나 왜곡될 수 있기 때문에 충돌 방지 시스테임이 필요

**CSMA/CA**

- 반이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 일련의 과정을 기반으로 사전에 가능한 한 충돌을 방지하는 방식.
- CSMA/CA로 프레임을 보낼 때 다음과 같은 과정이 일어남.
1. 사용 중인 채널이 있다면 다른 채널을 감지하다 유후 상태(해당 채널이 비어 있고, 아무도 데이터를 보내고 있지 않은 상태)인 채널을 발견.
2. 프레임 간 공간 시간인 IFS(InterFrame Space) 시간만큼 기다립니다. IFS는 프레임의 우선순위를 정의할 때도 사용됩니다. IFS가 낮으면 우선순위가 높음.
3. 프레임을 보내기 전 0 ~ 2^k - 1 사이에서 결정된 랜덤 상수를 기반으로 결
정된 시간만큼 기다린 뒤 프레임을 보냄. 프레임을 보낸 뒤 제대로 송신이 되었고 ACK 세그먼트를 받았다면 종료. 그러나 받지 못했다면 k= k + 1을 하며 이 과정을 반복. 반복하다 k가 정해진 Kmax보다 더 커진다면 해당 프레임전송은 버림(abort).
- 참고로 이와 반대되는 전이중화 통신은 양방향 통신이 가능하므로 충돌
가능성이 없기 때문에 충돌을 감지하거나 방지하는 메커니즘이 필요하지
않음.

**무선 LAN(WLAN, Wireless Local Area Network)을 이루는 주파수**

- 무선 LAN은 무선 신호 전달 방식을 이용하여 2대 이상의 장치를 연결하는 기술.
- 비유도 매체인 공기에 주파수를 쏘아 무선 통신망을 구축하는데, 주파수
대역은 2.4GHz 대역 또는 5GHz 대역 중 하나를 써서 구축.
- 2.4GHz는 장애물에 강한 특성을 가지고 있지만 전자레인지, 무선 등 전파 간섭이 일어나는 경우가 많고 5GHz 대역은 사용할 수 있는 채널 수도 많고
동시에 사용할 수 있기 때문에 상대적으로 깨끗한 전파 환경을 구축할 수
있음.
- 그렇기 때문에 보통은 5GHz 대역을 사용하는 것이 좋음.

**와이파이(wifi)**

- 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
- 이를 사용하려면 무선 접속 장치(AP, Access Point)가 있어야
함.
- 흔히 이를 공유기라고 하며, 이를 통해 유선 LAN에 흐르는 신호
를 무선 LAN 신호로 바꿔주어 신호가 닿는 범위 내에서 무선 인터넷을
사용할 수 있게 됨.
- 참고로 무선 LAN을 이용한 기술로는 와이파이만 있는 것이 아니고 지그비, 블루투스 등이 있습니다.

**BSS(Basic Service Set)**

- 기본 서비스 집합을 의미하며, 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP(무선 장치를 유선 네트워크에 연결해주는 장치)들과 장치들이 서로 통신이 가능한 구조.
- 근거리 무선 통신을 제공하고, 하나의 AP만을 기반으로 구축이 되어 있어 사용자가 한 곳에서 다른 곳으로 자유롭게 이동하며 네트워크에 접속하는 것은 불가능.

**ESS(Extended Service Set)**

- 하나 이상의 연결된 BSS 그룹
- 거리 무선 통신을 제공하며 BSS보다 더 많은 가용성과 이동성을 지원
- 사용자는 한 장소에서 다른 장소로 이동하며 중단 없이 네트워크에 계속 연결할 수 있음.

![image.png](attachment:9771b5f8-fe6e-4ad0-b021-654f50f14103:image.png)

**이더넷 프레임**

- 데이터 링크 계층은 이더넷 프레임을 통해 전달받은 데이터의 에
러를 검출하고 캡슐화하며 다음과 같은 구조
    
    ![image.png](attachment:095a04d0-266b-4a48-946d-4906cdba1f58:image.png)
    

- Preamble: 이더넷 프레임이 시작임을 알림.
- SFD(Start Frame Delimiter): 다음 바이트부터 MAC 주소 필드가 시작됨
을 알림.
- DMAC, SMAC: 수신, 송신 MAC 주소.
- EtherType: 데이터 계층 위의 계층인 IP 프로토콜을 정의.
    - 예를 들어 IPv4 또는 IPv6.
- Payload: 전달받은 데이터
- • CRC: 에러 확인 비트

**MAC 주소**

- 컴퓨터나 노트북 등 각 장치에는 네트워크에 연결하기 위한 장치(LAN 카드)가 있는데, 이를 구별하기 위한 식별번호를 말한다. 6바이트(48비트)로 구성

#### 계층 간 데이터 송수신 과정

- 컴퓨터를 통해 다른 컴퓨터로 데이터를 요청한다면 어떠한 일이 일어날까?
- 예를 들어 HTTP를 통해 웹 서버에 있는 데이터를 요청한다
면?
- 다음과 같은 일이 일어남

![image.png](attachment:2cb1c8b2-3341-4608-b434-344955e844be:image.png)

- 애플리케이션 계층에서 전송 계층으로 보내는 요청(request) 값들이 캡슐화 과정을 거쳐 전달
- 다시 링크 계층을 통해 해당 서버와 통신
- 해당 서버의 링크 계층으로부터 애플리케이션까지 비캡슐화 과정을 거쳐 데이터가 전송.

#### 캡슐화 과정

- 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정

![image.png](attachment:b50eec31-53f8-462f-bc21-da212ccf18cd:image.png)

- 애플리케이션 계층의 데이터가 전송 계층으로 전달되면서 ‘세그먼트’ 또는 ‘데이터그램’화되며 TCP(L4) 헤더가 붙여짐
- 이후 인터넷 계층으로 가면서 IP(L3) 헤더가 붙여지게 되며 ‘패킷’화가 되고, 이후 링크 계층으로 전달되면서 프레임 헤더와 프레임 트레일러가 붙어 ‘프
레임’화가 됨.

#### 비캡슐화 과정

- 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정

![image.png](attachment:b1e1ebe2-50cc-4e59-84ac-82ee2022c206:image.png)

- 캡슐화된 데이터를 받게 되면 링크 계층에서부터 타고 올라오면서 프레임화된 데이터는 다시 패킷화를 거쳐 세그먼트, 데이터그램화를 거쳐 메시지화가 되는 비캡슐화 과정이 진행.
- 그 이후 최종적으로 사용자에게 애플리케이션의 PDU인 메시지로 전달

PDU = Protocol Data Unit (프로토콜 데이터 단위)

## 프로젝트 개발
- 비밀번호 변경
  - 마이페이지에서 해당 회원의 페이지면 버튼 표시
  - 현재 비밀번호와 새로운 비밀번호 입력
  - 변경 후 로그아웃 진행 예정
  - 이전 재설정 api 사용하려 했지만 불필요한 내용이 있어 새로 작성
  - 뭔가 후딱 될 것 같으면서도 잘 안 되니 의욕도 잘 안 붙는 시기인 것 같음.

## 오늘의 회고
- 조금씩 개발을 덧붙여 나가는 식으로 천천히 해보자는 마음가짐으로 할 것.
- 너무 욕심만 내세워서 무리하게 하지 말 것.
- 지금 하는 것만이라도 꾸준히 천천히 해나갈 것.